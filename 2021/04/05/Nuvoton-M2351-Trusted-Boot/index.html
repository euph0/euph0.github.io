<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","version":"8.2.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}};
  </script>
<meta name="description" content="TL; DR结论是SecureBoot + Trustzone能做到：  确保boot流程是可信可控 能提供一个安全的签名验证机制 保证运行时安全">
<meta property="og:type" content="article">
<meta property="og:title" content="Nuvoton M2351 Trusted Boot">
<meta property="og:url" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/">
<meta property="og:site_name" content="Eupho&#39;s blog">
<meta property="og:description" content="TL; DR结论是SecureBoot + Trustzone能做到：  确保boot流程是可信可控 能提供一个安全的签名验证机制 保证运行时安全">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/Nuvoton-Secure-ARM-Cortex-M23-Fingerprint-Reader.jpg">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/finger_arch.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/bootSequence.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL1.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL1_component.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/identification.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/authentication.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/integrity.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL2_identification.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/publicKey.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1a.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1b.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/OTP.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.2.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3a.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3b.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3c.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4a.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4b.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4c.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.5a.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.5b.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/sequence.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/configBlock.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/erase.png">
<meta property="og:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/erase_pic.png">
<meta property="article:published_time" content="2021-04-05T07:35:44.000Z">
<meta property="article:modified_time" content="2021-04-05T08:02:34.926Z">
<meta property="article:author" content="Eupho">
<meta property="article:tag" content="Trusted Computing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/Nuvoton-Secure-ARM-Cortex-M23-Fingerprint-Reader.jpg">


<link rel="canonical" href="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>Nuvoton M2351 Trusted Boot | Eupho's blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Eupho's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Eupho's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#TL-DR"><span class="nav-number">1.</span> <span class="nav-text">TL; DR</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-number">2.</span> <span class="nav-text">名词解释</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.</span> <span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#boot%E6%B5%81%E7%A8%8B"><span class="nav-number">4.</span> <span class="nav-text">boot流程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BA%E4%BB%B6%E9%AA%8C%E8%AF%81%E6%9C%BA%E5%88%B6"><span class="nav-number">5.</span> <span class="nav-text">固件验证机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Secure-Bootloader%EF%BC%88NuBL1%EF%BC%89%E9%AA%8C%E8%AF%81NuBL2"><span class="nav-number">5.1.</span> <span class="nav-text">Secure Bootloader（NuBL1）验证NuBL2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E9%9C%80%E8%A6%81%E7%9A%84%E7%BB%84%E4%BB%B6"><span class="nav-number">5.1.1.</span> <span class="nav-text">验证需要的组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Identification"><span class="nav-number">5.1.2.</span> <span class="nav-text">Identification</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication"><span class="nav-number">5.1.3.</span> <span class="nav-text">Authentication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Integrity"><span class="nav-number">5.1.4.</span> <span class="nav-text">Integrity</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NuBL2%E9%AA%8C%E8%AF%81NuBL32-33"><span class="nav-number">5.2.</span> <span class="nav-text">NuBL2验证NuBL32&#x2F;33</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="nav-number">6.</span> <span class="nav-text">验证实现细节</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NuBL2-verification-function"><span class="nav-number">6.1.</span> <span class="nav-text">NuBL2 verification function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NuBL32-NuBL33-Public-Key-Storage"><span class="nav-number">6.2.</span> <span class="nav-text">NuBL32&#x2F;NuBL33 Public Key Storage</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E7%BB%93%E6%9E%9C"><span class="nav-number">7.</span> <span class="nav-text">实验结果</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C1%EF%BC%9A%E5%BC%95%E5%AF%BC%E5%90%AF%E5%8A%A8-Trustzone%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-number">7.1.</span> <span class="nav-text">实验1：引导启动+Trustzone权限控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C2%EF%BC%9A%E5%BE%80OTP%E5%86%85%E7%83%A7%E5%86%99%E5%85%AC%E9%92%A5hash"><span class="nav-number">7.2.</span> <span class="nav-text">实验2：往OTP内烧写公钥hash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C3%EF%BC%9A%E5%B0%9D%E8%AF%95%E4%BA%8C%E6%AC%A1%E4%BF%AE%E6%94%B9OTP"><span class="nav-number">7.3.</span> <span class="nav-text">实验3：尝试二次修改OTP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C4%EF%BC%9A%E9%AA%8C%E8%AF%81-BL1-secureboot-%E9%80%BB%E8%BE%91%E9%93%BE%EF%BC%9A%E4%BF%AE%E6%94%B9-BL2%E5%85%AC%E9%92%A5%EF%BC%8C%E4%BD%BF%E5%85%B6%E4%B8%8E-OTP-%E4%B8%8D%E5%8C%B9%E9%85%8D"><span class="nav-number">7.4.</span> <span class="nav-text">实验4：验证 BL1 secureboot 逻辑链：修改 BL2公钥，使其与 OTP 不匹配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C5%EF%BC%9A%E9%AA%8C%E8%AF%81BL2-secureboot%E9%80%BB%E8%BE%91%E9%93%BE"><span class="nav-number">7.5.</span> <span class="nav-text">实验5：验证BL2 secureboot逻辑链</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E7%9A%84%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="nav-number">8.</span> <span class="nav-text">可能的攻击面</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Eupho"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Eupho</p>
  <div class="site-description" itemprop="description">Welcome!</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/euph0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;euph0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ychen1996@yeah.net" title="E-Mail → mailto:ychen1996@yeah.net" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/05/Nuvoton-M2351-Trusted-Boot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Eupho">
      <meta itemprop="description" content="Welcome!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eupho's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nuvoton M2351 Trusted Boot
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2021-04-05 15:35:44 / Modified: 16:02:34" itemprop="dateCreated datePublished" datetime="2021-04-05T15:35:44+08:00">2021-04-05</time>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="Symbols count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Symbols count in article: </span>
      <span>6.7k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>6 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL; DR"></a>TL; DR</h1><p>结论是SecureBoot + Trustzone能做到：</p>
<ul>
<li>确保boot流程是可信可控</li>
<li>能提供一个安全的签名验证机制</li>
<li>保证运行时安全</li>
</ul>
<a id="more"></a>

<h1 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h1><p>NuBL1: secure bootloader</p>
<p>NuBL2: trusted boot code, customer loader</p>
<p>NuBL32: secure code</p>
<p>NuBL33: non-secure code</p>
<p>XOM: Execute-Only Memory</p>
<p>APROM: Application Program ROM，用来存储 application 代码</p>
<p>LDROM: ISP(In-System-Programming) Loader ROM，用来存储 Bootloader 固件</p>
<p>OTP: One-Time-Programmable Memory</p>
<p>NuBL2 Marker: consecutive 16-byte data, indicate the NuBL2 execution address and NuBL2 firmware information address.<br>The Secure Bootloader (NuBL1) will search the valid NuBL2 Marker first, and then obtain the NuBL2 firmware information to start the Secure Boot verification to NuBL2.</p>
<p>Exception Level: <a target="_blank" rel="noopener" href="https://developer.arm.com/architectures/learn-the-architecture/exception-model/privilege-and-exception-levels">privilege-and-exception-levels</a></p>
<h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p>通过TrustZone技术来保证安全启动，安全升级，防回滚攻击，安全存储，安全设备管理，安全调试等基础安全能力，并通过TrustZone技术来保证用户密码，生物特征的安全性。</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/Nuvoton-Secure-ARM-Cortex-M23-Fingerprint-Reader.jpg" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/finger_arch.png" class>

<h1 id="boot流程"><a href="#boot流程" class="headerlink" title="boot流程"></a>boot流程</h1><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/bootSequence.png" class>

<h1 id="固件验证机制"><a href="#固件验证机制" class="headerlink" title="固件验证机制"></a>固件验证机制</h1><h2 id="Secure-Bootloader（NuBL1）验证NuBL2"><a href="#Secure-Bootloader（NuBL1）验证NuBL2" class="headerlink" title="Secure Bootloader（NuBL1）验证NuBL2"></a>Secure Bootloader（NuBL1）验证NuBL2</h2><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL1.png" class>

<h3 id="验证需要的组件"><a href="#验证需要的组件" class="headerlink" title="验证需要的组件"></a>验证需要的组件</h3><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL1_component.png" class>

<h3 id="Identification"><a href="#Identification" class="headerlink" title="Identification"></a>Identification</h3><p>验证NuBL2 ECC 公钥的hash是否一致</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/identification.png" class>

<h3 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h3><p>使用ECC公钥验证ECDSA签名是否正确</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/authentication.png" class>

<h3 id="Integrity"><a href="#Integrity" class="headerlink" title="Integrity"></a>Integrity</h3><p>验证NuBL2 firmware hash</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/integrity.png" class>

<h2 id="NuBL2验证NuBL32-33"><a href="#NuBL2验证NuBL32-33" class="headerlink" title="NuBL2验证NuBL32/33"></a>NuBL2验证NuBL32/33</h2><p>验证NuBL32/33的流程与验证NuBL2的流程大致相同，区别在于</p>
<ul>
<li>在进行 identification 的时候，BL1 使用了存储在 OTP0~3 中的公钥hash，而 BL2 使用了 encrypted NuBL32/33 Public Key Storage，因此需要先进行 AES 解密</li>
</ul>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/NuBL2_identification.png" class>

<ul>
<li>NuBL32 info 存储在 secure Flash 中，而 NuBL33 info 在 non-secure Flash 中</li>
</ul>
<h1 id="验证实现细节"><a href="#验证实现细节" class="headerlink" title="验证实现细节"></a>验证实现细节</h1><h2 id="NuBL2-verification-function"><a href="#NuBL2-verification-function" class="headerlink" title="NuBL2 verification function"></a>NuBL2 verification function</h2><p>NuBL2 can call VerifyNuBL3x() API directly to perform NuBL32/NuBL33 identification, authentication and firmware integrity.<br>All the verification functions in VerifyNuBL3x.c could be configured as XOM code in the XOM region. Even if ICE debug mode is entered, the source code and procedure in XOM region cannot be traced.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ENABLE_XOM0_REGION (1)</span></span><br></pre></td></tr></table></figure>

<h2 id="NuBL32-NuBL33-Public-Key-Storage"><a href="#NuBL32-NuBL33-Public-Key-Storage" class="headerlink" title="NuBL32/NuBL33 Public Key Storage"></a>NuBL32/NuBL33 Public Key Storage</h2><p>An AES-256 key and IV (Initialization Vector) are declared in the NuBL2 project for decrypting the Public Key Storage to obtain the NuBL32/NuBL33 ECC public key.</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/publicKey.png" class>

<h1 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h1><h2 id="实验1：引导启动-Trustzone权限控制"><a href="#实验1：引导启动-Trustzone权限控制" class="headerlink" title="实验1：引导启动+Trustzone权限控制"></a>实验1：引导启动+Trustzone权限控制</h2><ul>
<li>BL32 (secure)<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1a.png" class></li>
<li>BL33 (non-secure)<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1b.png" class></li>
<li>实验现象<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.1.png" class>

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CPU @ 64000000 Hz (Non-secure flash base: 0x40000)</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL2 Sample Code    |</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Current CFG0: 0xffffffdf.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Device is successfully booting from Secure Bootloader(NuBL1) and device PID is 0x00235100]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 ECC public key hash are:</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line">    0xffffffff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 F&#x2F;W info in 0x00018000.</span><br><span class="line"></span><br><span class="line">Data are:</span><br><span class="line"></span><br><span class="line">    0x19385b75    0x9f3e5af0    0x99d5d432    0xaa342806</span><br><span class="line"></span><br><span class="line">    0x750f22c5    0x41785395    0x71638f4a    0xe22c156a</span><br><span class="line"></span><br><span class="line">    0xf113c491    0xb4d75e91    0x79fd7374    0x3dba4776</span><br><span class="line"></span><br><span class="line">    0x4322e883    0xf59a9077    0x0e530cb3    0xd79fd7aa</span><br><span class="line"></span><br><span class="line">    0x00000001    0x00000008    0x00000000    0x00003b38</span><br><span class="line"></span><br><span class="line">    0x0000000c    0x20180918    0x00000000    0x00000000</span><br><span class="line"></span><br><span class="line">    0xb37db884    0xac5bd510    0xaecc1b5d    0xe91cd5ce</span><br><span class="line"></span><br><span class="line">    0xf6aad5fd    0xc31dc48f    0x3e681c1c    0x219fda87</span><br><span class="line"></span><br><span class="line">    0x15531b62    0xc6effdb4    0xbf2f86f7    0x31c8e809</span><br><span class="line"></span><br><span class="line">    0xf029cd1a    0x42ae57d4    0x6468a63a    0x9b14aedf</span><br><span class="line"></span><br><span class="line">    0x14fa56ac    0xd80a1f1b    0x870ade9f    0xf535a24e</span><br><span class="line"></span><br><span class="line">    0x33d13cff    0xcdc7508c    0x0a8d12a8    0x02bec2ec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 identify NuBL32 public key and verify NuBL32 F&#x2F;W integrity PASS.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 identify NuBL33 public key and verify NuBL33 F&#x2F;W integrity PASS.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Jump to execute NuBL32...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CPU @ 64000000 Hz</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL32 Sample Code    |</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System is executing in NuBL32.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure code is running ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure PA11 LED On call by secure</span><br><span class="line"></span><br><span class="line">Execute non-secure code ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CPU @ 64000000 Hz</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL33 Sample Code    |</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System is executing in NuBL33.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Nonsecure code is running ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure PA11 LED Off call by non-secure</span><br><span class="line"></span><br><span class="line">!!---------------------------------------------------------------!!</span><br><span class="line"></span><br><span class="line">                       &lt;&lt;&lt; HardFault &gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">  [0x10040e4c] 0x600a STR 0x1 [0x4000482c]</span><br><span class="line"></span><br><span class="line">  Illegal access to Secure PA in Nonsecure code.</span><br><span class="line"></span><br><span class="line">!!---------------------------------------------------------------!!</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="实验2：往OTP内烧写公钥hash"><a href="#实验2：往OTP内烧写公钥hash" class="headerlink" title="实验2：往OTP内烧写公钥hash"></a>实验2：往OTP内烧写公钥hash</h2><ul>
<li>OTP<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/OTP.png" class></li>
<li>实验现象<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.2.png" class>

</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">CPU @ 64000000 Hz (Non-secure flash base: 0x40000)</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL2 Sample Code    |</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Current CFG0: 0xffffffdf.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Device is successfully booting from Secure Bootloader(NuBL1) and device PID is 0x00235100]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 ECC public key hash are:</span><br><span class="line"></span><br><span class="line">    0xe4735e14</span><br><span class="line"></span><br><span class="line">    0x2f226588</span><br><span class="line"></span><br><span class="line">    0x1674d9a4</span><br><span class="line"></span><br><span class="line">    0x70c6c071</span><br><span class="line"></span><br><span class="line">    0x06fe45ed</span><br><span class="line"></span><br><span class="line">    0x5ddb4cb2</span><br><span class="line"></span><br><span class="line">    0xabd707d5</span><br><span class="line"></span><br><span class="line">    0x6393ee35</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 F&#x2F;W info in 0x00018000.</span><br><span class="line"></span><br><span class="line">Data are:</span><br><span class="line"></span><br><span class="line">    0x19385b75    0x9f3e5af0    0x99d5d432    0xaa342806</span><br><span class="line"></span><br><span class="line">    0x750f22c5    0x41785395    0x71638f4a    0xe22c156a</span><br><span class="line"></span><br><span class="line">    0xf113c491    0xb4d75e91    0x79fd7374    0x3dba4776</span><br><span class="line"></span><br><span class="line">    0x4322e883    0xf59a9077    0x0e530cb3    0xd79fd7aa</span><br><span class="line"></span><br><span class="line">    0x00000001    0x00000008    0x00000000    0x00003b38</span><br><span class="line"></span><br><span class="line">    0x0000000c    0x20180918    0x00000000    0x00000000</span><br><span class="line"></span><br><span class="line">    0xb37db884    0xac5bd510    0xaecc1b5d    0xe91cd5ce</span><br><span class="line"></span><br><span class="line">    0xf6aad5fd    0xc31dc48f    0x3e681c1c    0x219fda87</span><br><span class="line"></span><br><span class="line">    0x9637e985    0xe45efcd2    0x4b90f802    0x499df41d</span><br><span class="line"></span><br><span class="line">    0x1cbddc75    0x935e8297    0x1088c0bd    0x3f2b4fb3</span><br><span class="line"></span><br><span class="line">    0xd662d4a6    0x668124d2    0xbd75d4b3    0x7e5b580b</span><br><span class="line"></span><br><span class="line">    0xbd87b172    0x33687484    0xeba4238b    0xb771d320</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 identify NuBL32 public key and verify NuBL32 F&#x2F;W integrity PASS.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 identify NuBL33 public key and verify NuBL33 F&#x2F;W integrity PASS.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Jump to execute NuBL32...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CPU @ 64000000 Hz</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL32 Sample Code    |</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System is executing in NuBL32.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure code is running ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Secure PA11 LED On call by secure</span><br><span class="line"></span><br><span class="line">Execute non-secure code ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CPU @ 64000000 Hz</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL33 Sample Code    |</span><br><span class="line"></span><br><span class="line">+-------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System is executing in NuBL33.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Nonsecure code is running ...</span><br></pre></td></tr></table></figure>

<h2 id="实验3：尝试二次修改OTP"><a href="#实验3：尝试二次修改OTP" class="headerlink" title="实验3：尝试二次修改OTP"></a>实验3：尝试二次修改OTP</h2><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3a.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3b.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.3c.png" class>

<h2 id="实验4：验证-BL1-secureboot-逻辑链：修改-BL2公钥，使其与-OTP-不匹配"><a href="#实验4：验证-BL1-secureboot-逻辑链：修改-BL2公钥，使其与-OTP-不匹配" class="headerlink" title="实验4：验证 BL1 secureboot 逻辑链：修改 BL2公钥，使其与 OTP 不匹配"></a>实验4：验证 BL1 secureboot 逻辑链：修改 BL2公钥，使其与 OTP 不匹配</h2><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4a.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4b.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.4c.png" class>

<h2 id="实验5：验证BL2-secureboot逻辑链"><a href="#实验5：验证BL2-secureboot逻辑链" class="headerlink" title="实验5：验证BL2 secureboot逻辑链"></a>实验5：验证BL2 secureboot逻辑链</h2><p>修改BL32 FW</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.5a.png" class>
<p>修改BL32 FWinfo Hash</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/6.5b.png" class>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">CPU @ 64000000 Hz (Non-secure flash base: 0x40000)</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line">|    SecureBootDemo - NuBL2 Sample Code    |</span><br><span class="line"></span><br><span class="line">+------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Current CFG0: 0xffffffdf.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Device is successfully booting from Secure Bootloader(NuBL1) and device PID is 0x00235100]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 ECC public key hash are:</span><br><span class="line"></span><br><span class="line">    0xe4735e14</span><br><span class="line"></span><br><span class="line">    0x2f226588</span><br><span class="line"></span><br><span class="line">    0x1674d9a4</span><br><span class="line"></span><br><span class="line">    0x70c6c071</span><br><span class="line"></span><br><span class="line">    0x06fe45ed</span><br><span class="line"></span><br><span class="line">    0x5ddb4cb2</span><br><span class="line"></span><br><span class="line">    0xabd707d5</span><br><span class="line"></span><br><span class="line">    0x6393ee35</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 F&#x2F;W info in 0x00018000.</span><br><span class="line"></span><br><span class="line">Data are:</span><br><span class="line"></span><br><span class="line">    0x19385b75    0x9f3e5af0    0x99d5d432    0xaa342806</span><br><span class="line"></span><br><span class="line">    0x750f22c5    0x41785395    0x71638f4a    0xe22c156a</span><br><span class="line"></span><br><span class="line">    0xf113c491    0xb4d75e91    0x79fd7374    0x3dba4776</span><br><span class="line"></span><br><span class="line">    0x4322e883    0xf59a9077    0x0e530cb3    0xd79fd7aa</span><br><span class="line"></span><br><span class="line">    0x00000001    0x00000008    0x00000000    0x00003b38</span><br><span class="line"></span><br><span class="line">    0x0000000c    0x20180918    0x00000000    0x00000000</span><br><span class="line"></span><br><span class="line">    0xb37db884    0xac5bd510    0xaecc1b5d    0xe91cd5ce</span><br><span class="line"></span><br><span class="line">    0xf6aad5fd    0xc31dc48f    0x3e681c1c    0x219fda87</span><br><span class="line"></span><br><span class="line">    0xcf347c60    0x57989753    0xd328a35e    0x4865021c</span><br><span class="line"></span><br><span class="line">    0xaeb61ee0    0x678c0233    0xa28016f0    0x6314807b</span><br><span class="line"></span><br><span class="line">    0xf0c7b338    0x171d427a    0xae91ab5d    0xdfd711b6</span><br><span class="line"></span><br><span class="line">    0xe9981085    0x7091d2c0    0x22cd3e89    0xe9563327</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NuBL2 verifies NuBL32 FAIL.</span><br></pre></td></tr></table></figure>

<h1 id="可能的攻击面"><a href="#可能的攻击面" class="headerlink" title="可能的攻击面"></a>可能的攻击面</h1><img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/sequence.png" class>
<p>NuBL1是安全的：因为写在Mask ROM里面，不可修改<br>BL1引导BL2的过程是怎么保证安全：BL1会去验证BL2的ECDSA签名，私钥是开发者管理<br>BL2是安全的：secure flash<br>BL2引导BL3的过程是怎么保证安全：同理，验证ECDSA签名</p>
<p><strong>问题是</strong>：</p>
<ul>
<li>引导跳过Secure Bootloader（BL1）</li>
</ul>
<p>User Configuration block 是 4 个 32bit 的字（CONFIG0, CONFIG1, CONFIG2 and CONFIG3），其中 CONFIG0 的 5th bit 和 7th bit 负责控制 booting 的来源。</p>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/configBlock.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/erase.png" class>
<img src="/2021/04/05/Nuvoton-M2351-Trusted-Boot/erase_pic.png" class>

<ul>
<li>dump：可以直接拿到BL32的secure code，内存未加密</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Trusted-Computing/" rel="tag"># Trusted Computing</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/04/05/Intel-%E5%90%AF%E5%8A%A8%E4%BF%9D%E6%8A%A4/" rel="prev" title="Intel 启动保护">
                  <i class="fa fa-chevron-left"></i> Intel 启动保护
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2020 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Eupho</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">32k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">29 mins.</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">

<script>
NexT.utils.loadComments('.gitalk-container', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '905d85844f36f5944183',
      clientSecret: 'db8c951f2bf071c9767496cf55a9e0298ede8be8',
      repo        : 'blog_comments',
      owner       : 'euph0',
      admin       : ['euph0'],
      id          : '12f4d6b13877a40688dbb7423914f02b',
        language: 'zh-CH',
      distractionFreeMode: true
    });
    gitalk.render(document.querySelector('.gitalk-container'));
  }, window.Gitalk);
});
</script>

</body>
</html>
